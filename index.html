<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬è»Šå°å¹«æ‰‹ - AI ä¹˜å®¢å›é¥‹</title>
    
    <!-- 1. è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. è¼‰å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 3. è¼‰å…¥ Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 4. è¼‰å…¥ Firebase (Compat ç‰ˆæœ¬) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin-slow { animation: spin-slow 3s linear infinite; }
        @keyframes bounce-slow { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
        .animate-bounce-slow { animation: bounce-slow 2s ease-in-out infinite; }
        .cursor-wait { cursor: wait; }
    </style>
</head>
<body class="bg-yellow-50 text-gray-700 font-sans selection:bg-pink-200 selection:text-pink-800">
    
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- 1. Firebase åˆå§‹åŒ–è¨­å®š (ä¿ç•™æ‚¨çš„è¨­å®š) ---
        const manualConfig = {
            apiKey: "AIzaSyCyIXyAxsRS9pjfkM618tceW1sz0meCum4",
            authDomain: "project1127-76129.firebaseapp.com",
            projectId: "project1127-76129",
            storageBucket: "project1127-76129.firebasestorage.app",
            messagingSenderId: "161560831290",
            appId: "1:161560831290:web:a74643355fae218bb79c03"
        };

        let app, auth, db;
        let configError = false;

        try {
            if (!firebase.apps.length) {
                app = firebase.initializeApp(manualConfig);
            } else {
                app = firebase.app();
            }
            auth = firebase.auth();
            db = firebase.firestore();
        } catch (e) {
            console.error("Firebase Init Error:", e);
            configError = true;
        }

        const appId = manualConfig.projectId || 'default-app-id';

        // --- 2. åœ–ç¤ºå…ƒä»¶ ---
        const IconBase = ({ d, className, fill="none", stroke="currentColor" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill={fill} stroke={stroke} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {d}
            </svg>
        );
        const Bus = (props) => <IconBase {...props} d={<><path d="M8 6v6"/><path d="M15 6v6"/><path d="M2 12h19.6"/><path d="M18 18h3s.5-1.7.8-2.8c.1-.4.2-.8.2-1.2 0-.4-.1-.8-.2-1.2l-1.4-5C20.1 6.8 19.1 6 18 6H4a2 2 0 0 0-2 2v10h3"/><circle cx="7" cy="18" r="2"/><path d="M9 18h5"/><circle cx="16" cy="18" r="2"/></>} />;
        const MessageCircle = (props) => <IconBase {...props} d={<><path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"/></>} />;
        const Send = (props) => <IconBase {...props} d={<><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></>} />;
        const Zap = (props) => <IconBase {...props} d={<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>} />;
        const Smile = (props) => <IconBase {...props} d={<><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></>} />;
        const Frown = (props) => <IconBase {...props} d={<><circle cx="12" cy="12" r="10"/><path d="M16 16s-1.5-2-4-2-4 2-4 2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></>} />;
        const Meh = (props) => <IconBase {...props} d={<><circle cx="12" cy="12" r="10"/><line x1="8" y1="15" x2="16" y2="15"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></>} />;
        const BarChart2 = (props) => <IconBase {...props} d={<><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></>} />;
        const Clock = (props) => <IconBase {...props} d={<><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>} />;
        const User = (props) => <IconBase {...props} d={<><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>} />;
        const Sparkles = (props) => <IconBase {...props} d={<><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z"/></>} />;
        const AlertTriangle = (props) => <IconBase {...props} d={<><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></>} />;
        const MapPin = (props) => <IconBase {...props} d={<><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></>} />;

        // --- 3. AI æ¨¡æ“¬èˆ‡å…ƒä»¶ ---
        const simulateAIAnalysis = async (text) => {
            return new Promise((resolve) => {
                setTimeout(() => {
                    let sentiment = 'neutral';
                    let category = 'other';
                    const lowerText = text.toLowerCase();
                    if (lowerText.match(/æ…¢|é²åˆ°|ç­‰å¾ˆä¹…|èª¤é»/)) category = 'punctuality';
                    else if (lowerText.match(/é«’|åƒåœ¾|è‡­|ä¸ä¹¾æ·¨/)) category = 'cleanliness';
                    else if (lowerText.match(/å¸æ©Ÿ|æ…‹åº¦|å…‡|ç½µäºº|è¶…é€Ÿ|å¾ˆå…‡|æ€¥ç…/)) category = 'driver';
                    else if (lowerText.match(/å†·æ°£|åº§ä½|æ“æ“ /)) category = 'comfort';

                    if (lowerText.match(/å¾ˆå¥½|éå¸¸å¥½|æ£’|è®š|æ„Ÿè¬|è¬è¬|èˆ’æœ|æº–æ™‚|å–œæ­¡/)) sentiment = 'positive';
                    else if (lowerText.match(/çˆ›|å·®|æ…¢|è¨å­|ç”Ÿæ°£|å±éšª|é«’/)) sentiment = 'negative';
                    resolve({ sentiment, category });
                }, 1200);
            });
        };

        // å¯æ„›å…¬è»Šç¤ºæ„åœ–å…ƒä»¶
        const CuteBusIllustration = () => (
            <div className="relative w-full h-32 bg-blue-100 rounded-3xl overflow-hidden flex items-center justify-center mb-6 border-4 border-white shadow-inner">
                {/* è·¯é¢ */}
                <div className="absolute bottom-0 w-full h-8 bg-gray-300"></div>
                <div className="absolute bottom-3 w-full border-t-2 border-dashed border-white"></div>
                
                {/* å…¬è»Šæœ¬é«” */}
                <div className="relative z-10 animate-bounce-slow">
                    <div className="w-24 h-16 bg-yellow-300 rounded-xl border-2 border-yellow-500 relative shadow-lg">
                        {/* çª—æˆ¶ */}
                        <div className="absolute top-2 left-2 right-8 h-6 bg-blue-200 rounded border border-blue-300"></div>
                        {/* é–€ */}
                        <div className="absolute top-2 right-2 w-4 h-10 bg-white/50 rounded border border-yellow-600"></div>
                        {/* è¼ªèƒ */}
                        <div className="absolute -bottom-2 left-3 w-5 h-5 bg-gray-700 rounded-full border-2 border-gray-500 animate-spin-slow"></div>
                        <div className="absolute -bottom-2 right-3 w-5 h-5 bg-gray-700 rounded-full border-2 border-gray-500 animate-spin-slow"></div>
                    </div>
                    {/* å»¢æ°£ */}
                    <div className="absolute top-10 -left-4">
                        <Sparkles className="w-4 h-4 text-gray-400 animate-pulse" />
                    </div>
                </div>
                
                {/* é›²æœµè£é£¾ */}
                <div className="absolute top-4 left-4 w-8 h-4 bg-white rounded-full opacity-80"></div>
                <div className="absolute top-8 right-10 w-6 h-3 bg-white rounded-full opacity-60"></div>
            </div>
        );

        // é¦¬å¡é¾é•·æ¢åœ–
        const SimpleBarChart = ({ data }) => {
            const max = Math.max(...data.map(d => d.value), 1);
            return (
                <div className="space-y-4">
                    {data.map((item) => (
                        <div key={item.label} className="group">
                            <div className="flex justify-between text-xs text-gray-500 mb-1 font-bold pl-1">
                                <span>{item.label}</span>
                                <span>{item.value} å‰‡</span>
                            </div>
                            <div className="w-full h-4 bg-gray-100 rounded-full overflow-hidden shadow-inner">
                                <div 
                                    className={`h-full rounded-full transition-all duration-1000 ease-out group-hover:brightness-110 ${item.color}`}
                                    style={{ width: `${(item.value / max) * 100}%` }}
                                ></div>
                            </div>
                        </div>
                    ))}
                </div>
            );
        };

        // é¦¬å¡é¾åœ“é¤…åœ–
        const SentimentPie = ({ stats }) => {
            const total = stats.positive + stats.neutral + stats.negative;
            if (total === 0) return <div className="text-gray-400 text-center py-8 font-bold bg-gray-50 rounded-2xl">ç­‰å¾…æ•¸æ“šä¸­...</div>;

            const posPct = (stats.positive / total) * 100;
            const neuPct = (stats.neutral / total) * 100;

            const gradient = `conic-gradient(
                #bbf7d0 0% ${posPct}%, 
                #e5e7eb ${posPct}% ${posPct + neuPct}%, 
                #fecaca ${posPct + neuPct}% 100%
            )`;

            return (
                <div className="flex flex-col items-center">
                    <div 
                        className="relative w-40 h-40 rounded-full shadow-xl mb-4 transform hover:scale-105 transition-transform border-4 border-white"
                        style={{ background: gradient }}
                    >
                        <div className="absolute inset-0 m-auto w-16 h-16 bg-white rounded-full shadow-inner flex items-center justify-center">
                           <span className="text-xl font-black text-gray-600">{total}</span>
                        </div>
                    </div>
                    <div className="flex space-x-4 text-xs font-bold text-gray-600">
                        <div className="flex items-center"><div className="w-3 h-3 bg-green-200 rounded-full mr-1 border border-green-300"></div>æ­£å‘</div>
                        <div className="flex items-center"><div className="w-3 h-3 bg-gray-200 rounded-full mr-1 border border-gray-300"></div>ä¸­ç«‹</div>
                        <div className="flex items-center"><div className="w-3 h-3 bg-red-200 rounded-full mr-1 border border-red-300"></div>è² å‘</div>
                    </div>
                </div>
            );
        };

        const ConfigErrorModal = () => (
            <div className="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4">
                <div className="bg-white rounded-3xl p-8 max-w-md w-full shadow-2xl border-4 border-red-100 text-center">
                    <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <AlertTriangle className="w-8 h-8 text-red-500" />
                    </div>
                    <h2 className="text-xl font-black text-gray-800 mb-2">è¨­å®šéŒ¯èª¤</h2>
                    <p className="text-gray-500 mb-6 text-sm leading-relaxed">
                        Firebase åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹æª¢æŸ¥æ‚¨çš„ API Key æ˜¯å¦æ­£ç¢ºã€‚
                    </p>
                </div>
            </div>
        );

        // --- ä¸»ç¨‹å¼ ---
        const App = () => {
            if (configError) return <ConfigErrorModal />;

            const [user, setUser] = useState(null);
            const [feedbackList, setFeedbackList] = useState([]);
            const [busNumber, setBusNumber] = useState('');
            const [nickname, setNickname] = useState(''); 
            const [message, setMessage] = useState('');
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [aiResult, setAiResult] = useState(null);

            useEffect(() => {
                const initAuth = async () => {
                    try {
                        // ç›´æ¥ä½¿ç”¨åŒ¿åç™»å…¥
                        await auth.signInAnonymously();
                    } catch (error) {
                        console.error("Auth failed", error);
                    }
                };
                initAuth();
                const unsubscribe = auth.onAuthStateChanged((u) => setUser(u));
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user) return;
                
                // ä½¿ç”¨æ‚¨çš„ Project ID ç¢ºä¿è³‡æ–™åªå­˜åœ¨æ‚¨çš„å°ˆæ¡ˆä¸­
                // collection è·¯å¾‘: bus_data/school_project/feedbacks
                const unsubscribe = db.collection('bus_data').doc('school_project')
                    .collection('feedbacks')
                    .orderBy('createdAt', 'desc')
                    .onSnapshot((snapshot) => {
                        const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setFeedbackList(docs);
                    }, (error) => {
                        console.error("Data fetch error", error);
                    });
                return () => unsubscribe();
            }, [user]);

            const stats = useMemo(() => {
                const s = {
                    sentiment: { positive: 0, neutral: 0, negative: 0 },
                    categories: { driver: 0, cleanliness: 0, punctuality: 0, comfort: 0, other: 0 }
                };
                feedbackList.forEach(item => {
                    if (s.sentiment[item.sentiment] !== undefined) s.sentiment[item.sentiment]++;
                    if (s.categories[item.category] !== undefined) s.categories[item.category]++;
                    else s.categories.other++;
                });
                return s;
            }, [feedbackList]);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!message || !busNumber || !user) return;
                setIsAnalyzing(true);
                setAiResult(null);

                try {
                    const analysis = await simulateAIAnalysis(message);
                    setAiResult(analysis);
                    const displayName = nickname.trim() ? nickname : `åŒå­¸ ${user.uid.slice(0, 3)}`;

                    await db.collection('bus_data').doc('school_project')
                        .collection('feedbacks')
                        .add({
                            busNumber,
                            message,
                            sentiment: analysis.sentiment,
                            category: analysis.category,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            userId: user.uid,
                            userName: displayName
                        });

                    setMessage('');
                    setBusNumber('');
                    setTimeout(() => {
                        setIsAnalyzing(false);
                        setAiResult(null);
                    }, 3000);
                } catch (error) {
                    console.error("Submit error", error);
                    setIsAnalyzing(false);
                }
            };

            const getCategoryLabel = (cat) => ({ driver: 'å¸æ©Ÿé§•é§›', cleanliness: 'è»Šå…§æ•´æ½”', punctuality: 'æº–é»ç‹€æ³', comfort: 'èˆ’é©åº¦', other: 'å…¶ä»–' }[cat] || 'å…¶ä»–');
            const getSentimentIcon = (sent) => {
                if (sent === 'positive') return <Smile className="text-green-500 w-5 h-5 drop-shadow-sm" />;
                if (sent === 'negative') return <Frown className="text-red-400 w-5 h-5 drop-shadow-sm" />;
                return <Meh className="text-gray-400 w-5 h-5 drop-shadow-sm" />;
            };

            return (
                <div className="min-h-screen pb-10">
                    
                    {/* Navbar */}
                    <div className="max-w-7xl mx-auto pt-6 px-4 mb-4">
                        <nav className="bg-white/80 backdrop-blur-md rounded-full shadow-lg border-2 border-white px-6 py-3 flex justify-between items-center">
                            <div className="flex items-center space-x-3">
                                <div className="bg-gradient-to-tr from-blue-300 to-purple-300 p-2 rounded-full shadow-md text-white">
                                    <Bus className="w-6 h-6" />
                                </div>
                                <h1 className="text-xl font-black text-gray-700 tracking-tight">
                                    å…¬è»Šå°å¹«æ‰‹ <span className="text-sm font-medium text-pink-500 bg-pink-100 px-3 py-1 rounded-full ml-2">AI ä¹˜å®¢å›é¥‹</span>
                                </h1>
                            </div>
                            <div className="flex items-center space-x-2">
                                <div className={`w-3 h-3 rounded-full ${user ? 'bg-green-400 animate-pulse' : 'bg-gray-300'}`}></div>
                                <span className="text-sm font-bold text-gray-500">{user ? 'é€£ç·šæˆåŠŸ' : 'é€£ç·šä¸­...'}</span>
                            </div>
                        </nav>
                    </div>

                    <main className="max-w-7xl mx-auto p-4 lg:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
                        
                        {/* å·¦å´ï¼šæ§åˆ¶é¢æ¿ */}
                        <section className="lg:col-span-3 space-y-6">
                            <div className="bg-white rounded-3xl p-6 shadow-xl border-4 border-blue-50 relative overflow-hidden group hover:border-blue-100 transition-all">
                                <div className="absolute -right-6 -top-6 w-24 h-24 bg-blue-100 rounded-full opacity-50"></div>
                                
                                <h2 className="text-lg font-black mb-4 flex items-center text-gray-700">
                                    <MessageCircle className="w-6 h-6 mr-2 text-blue-400" />
                                    æˆ‘è¦ç•™è¨€
                                </h2>
                                
                                <form onSubmit={handleSubmit} className="space-y-4 relative z-10">
                                    <div className="bg-gray-50 p-3 rounded-2xl border border-gray-100">
                                        <label className="block text-xs font-bold text-gray-400 mb-1 ml-1">ä½ çš„æš±ç¨± (é¸å¡«)</label>
                                        <input 
                                            type="text" 
                                            value={nickname}
                                            onChange={(e) => setNickname(e.target.value)}
                                            placeholder="å¦‚: å°æ˜"
                                            className="w-full bg-white border-0 rounded-xl px-4 py-2 focus:ring-2 focus:ring-blue-200 outline-none text-gray-700 font-bold placeholder-gray-300 shadow-sm"
                                        />
                                    </div>

                                    <div className="bg-gray-50 p-3 rounded-2xl border border-gray-100">
                                        <label className="block text-xs font-bold text-gray-400 mb-1 ml-1">è·¯ç·šè™Ÿç¢¼</label>
                                        <input 
                                            type="text" 
                                            value={busNumber}
                                            onChange={(e) => setBusNumber(e.target.value)}
                                            placeholder="å¦‚: 307"
                                            className="w-full bg-white border-0 rounded-xl px-4 py-2 focus:ring-2 focus:ring-blue-200 outline-none text-gray-700 font-bold placeholder-gray-300 shadow-sm"
                                            required
                                        />
                                    </div>
                                    
                                    <div className="bg-gray-50 p-3 rounded-2xl border border-gray-100">
                                        <label className="block text-xs font-bold text-gray-400 mb-1 ml-1">æ­ä¹˜æ„Ÿè¦º</label>
                                        <textarea 
                                            value={message}
                                            onChange={(e) => setMessage(e.target.value)}
                                            placeholder="å¸æ©Ÿäººå¾ˆå¥½..."
                                            rows="4"
                                            className="w-full bg-white border-0 rounded-xl px-4 py-2 focus:ring-2 focus:ring-blue-200 outline-none text-gray-700 placeholder-gray-300 resize-none shadow-sm"
                                            required
                                        ></textarea>
                                    </div>

                                    <button 
                                        type="submit" 
                                        disabled={isAnalyzing || !user}
                                        className={`w-full py-3 rounded-2xl font-bold text-white shadow-md transform transition-all active:scale-95 flex justify-center items-center ${
                                            isAnalyzing 
                                                ? 'bg-purple-300 cursor-wait' 
                                                : 'bg-gradient-to-r from-blue-400 to-purple-400 hover:from-blue-500 hover:to-purple-500 hover:shadow-lg hover:-translate-y-1'
                                        }`}
                                    >
                                        {isAnalyzing ? <Sparkles className="animate-spin w-5 h-5" /> : <><Send className="w-5 h-5 mr-2" /> é€å‡º</>}
                                    </button>
                                </form>

                                {aiResult && (
                                    <div className="mt-4 bg-gradient-to-r from-pink-50 to-purple-50 rounded-2xl p-4 border border-pink-100 animate-bounce-in shadow-inner">
                                        <p className="text-xs text-purple-400 font-bold mb-2 flex items-center"><Sparkles className="w-3 h-3 mr-1" /> AI åˆ¤è®€å®Œæˆ</p>
                                        <div className="flex justify-between items-center bg-white/60 rounded-xl p-2">
                                            <span className="text-sm font-bold text-gray-600">{getCategoryLabel(aiResult.category)}</span>
                                            <span className={`text-sm font-black px-2 py-1 rounded-lg ${
                                                aiResult.sentiment === 'positive' ? 'bg-green-100 text-green-600' : 
                                                aiResult.sentiment === 'negative' ? 'bg-red-100 text-red-500' : 'bg-gray-100 text-gray-500'
                                            }`}>
                                                {aiResult.sentiment === 'positive' ? 'æ­£å‘ ğŸ˜Š' : 
                                                 aiResult.sentiment === 'negative' ? 'è² å‘ ğŸ˜ ' : 'ä¸­ç«‹ ğŸ˜'}
                                            </span>
                                        </div>
                                    </div>
                                )}
                            </div>
                            
                            <div className="bg-white/50 p-4 rounded-3xl border border-white text-center">
                                <p className="text-xs text-gray-400 font-medium">âœ¨ AI è‡ªå‹•å¹«ä½ çš„ç•™è¨€åˆ†é¡ âœ¨</p>
                            </div>
                        </section>

                        {/* ä¸­é–“ï¼šåœ–è¡¨èˆ‡ç¤ºæ„åœ– */}
                        <section className="lg:col-span-5 space-y-6">
                            <div className="bg-white rounded-3xl p-6 shadow-xl border-4 border-pink-50 h-full flex flex-col">
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-lg font-black text-gray-700 flex items-center">
                                        <BarChart2 className="w-6 h-6 mr-2 text-pink-400" />
                                        æ•¸æ“šåˆ†æ
                                    </h2>
                                    <span className="bg-pink-100 text-pink-500 text-xs font-bold px-3 py-1 rounded-full">Live</span>
                                </div>

                                <CuteBusIllustration />

                                <div className="flex-1 space-y-8">
                                    <div>
                                        <h3 className="text-sm font-bold text-gray-400 mb-3 ml-1">å•é¡Œé¡å‹çµ±è¨ˆ</h3>
                                        <SimpleBarChart data={[
                                            { label: 'å¸æ©Ÿé§•é§›', value: stats.categories.driver, color: 'bg-blue-300' },
                                            { label: 'æº–é»ç‹€æ³', value: stats.categories.punctuality, color: 'bg-yellow-300' },
                                            { label: 'è»Šå…§æ•´æ½”', value: stats.categories.cleanliness, color: 'bg-purple-300' },
                                            { label: 'èˆ’é©åº¦', value: stats.categories.comfort, color: 'bg-pink-300' },
                                            { label: 'å…¶ä»–', value: stats.categories.other, color: 'bg-gray-300' },
                                        ]} />
                                    </div>

                                    <div className="bg-gray-50 rounded-2xl p-4">
                                        <h3 className="text-sm font-bold text-gray-400 mb-3 text-center">å¤§å®¶çš„å¿ƒæƒ…åˆ†ä½ˆ</h3>
                                        <SentimentPie stats={stats.sentiment} />
                                    </div>
                                </div>
                            </div>
                        </section>

                        {/* å³å´ï¼šå³æ™‚ç´€éŒ„å€ */}
                        <section className="lg:col-span-4 flex flex-col h-[600px] lg:h-auto">
                            <div className="bg-white rounded-3xl shadow-xl border-4 border-green-50 flex flex-col h-full overflow-hidden">
                                <div className="p-5 border-b border-gray-100 bg-white sticky top-0 z-10">
                                    <h2 className="text-lg font-black text-gray-700 flex items-center">
                                        <Zap className="w-6 h-6 mr-2 text-yellow-400 fill-yellow-400" />
                                        å³æ™‚å‹•æ…‹
                                    </h2>
                                </div>

                                <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50/50 scrollbar-hide">
                                    {feedbackList.length === 0 ? (
                                        <div className="flex flex-col items-center justify-center h-full text-gray-300 space-y-2">
                                            <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center">
                                                <MessageCircle className="w-8 h-8" />
                                            </div>
                                            <p className="font-bold">é‚„æ²’æœ‰ç•™è¨€å–”</p>
                                        </div>
                                    ) : (
                                        feedbackList.map((item) => (
                                            <div key={item.id} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-100 hover:shadow-md transition-shadow relative group">
                                                <div className={`absolute top-4 right-4 w-2 h-2 rounded-full ${
                                                    item.sentiment === 'positive' ? 'bg-green-300' : 
                                                    item.sentiment === 'negative' ? 'bg-red-300' : 'bg-gray-300'
                                                }`}></div>

                                                <div className="flex items-center mb-2">
                                                    <div className="w-8 h-8 rounded-full bg-gradient-to-br from-blue-100 to-purple-100 flex items-center justify-center mr-2 border border-white shadow-sm">
                                                        <User className="w-4 h-4 text-gray-500" />
                                                    </div>
                                                    <div>
                                                        <div className="text-xs font-bold text-gray-800">{item.userName}</div>
                                                        <div className="text-[10px] text-gray-400 flex items-center">
                                                            <Clock className="w-3 h-3 mr-1" />
                                                            {item.createdAt?.seconds ? new Date(item.createdAt.seconds * 1000).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 'å‰›å‰›'}
                                                        </div>
                                                    </div>
                                                </div>

                                                <div className="bg-gray-50 rounded-xl p-3 mb-2 relative">
                                                    <div className="absolute -top-2 left-4 w-4 h-4 bg-gray-50 transform rotate-45"></div>
                                                    <p className="text-sm text-gray-600 font-medium relative z-10">{item.message}</p>
                                                </div>

                                                <div className="flex justify-between items-center mt-2 px-1">
                                                    <div className="flex items-center space-x-2">
                                                        <span className="bg-blue-100 text-blue-600 text-[10px] font-bold px-2 py-1 rounded-lg">
                                                            ğŸšŒ {item.busNumber}
                                                        </span>
                                                        <span className="bg-purple-100 text-purple-600 text-[10px] font-bold px-2 py-1 rounded-lg">
                                                            #{getCategoryLabel(item.category)}
                                                        </span>
                                                    </div>
                                                    <div className="transform group-hover:scale-110 transition-transform">
                                                        {getSentimentIcon(item.sentiment)}
                                                    </div>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                                
                                <div className="p-3 bg-white border-t border-gray-100 text-center">
                                    <span className="text-xs font-bold text-gray-400 bg-gray-100 px-3 py-1 rounded-full">
                                        å…± {feedbackList.length} å‰‡ç´€éŒ„
                                    </span>
                                </div>
                            </div>
                        </section>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>